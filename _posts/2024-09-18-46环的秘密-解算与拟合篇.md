---
title: 46 环的秘密—解算与拟合篇
data: 2024-09-18 15:38:44 +0800
categories: [RoboMaster, 能量机关]
tags: [RoboMaster, 坐标变换, 最小二乘拟合, 能量机关]
math: true
description: 能量机关解算与拟合算法详解
author: zmsbruce
---

书接上文，在得到特征点之后，我们便可以拿到其像素坐标。接下来，我们对其进行一系列解算，得到连续的角度信息，角度信息进而被拿来进行拟合，得到大能量机关的参数。

# 角度解算

首先，根据特征点的像素坐标和其对应的世界坐标进行 PnP 解算，得到 $$3\times 1$$ 的旋转向量和平移向量，再将其转为 $$4\times 4$$ 的变换矩阵 $$T_1$$，其将世界坐标系转换为相机坐标系。

> 关于 PnP 解算的方法，经实验选择**迭代法**会比其他方法得到更准确且稳定的结果。
{: .prompt-info}

相机到云台的坐标系变换矩阵 $$T_2$$ 由先验参数得到（可以用尺子测量或者找机械的同学在 SolidWorks 中得到），而云台到车身的坐标变换 $$T_3$$ 则根据当前车身的 roll, pitch 和 yaw 获得。最终，我们得到了世界坐标系转车身坐标系的变换矩阵 $$T$$ 为：

$$
T=T_3\times T_2\times T_1
$$

那么该变换矩阵对应的旋转矩阵为：

$$
R=T_{0,0}(3,3)
$$

有关世界到相机、相机到云台、云台到车身的坐标系如下图所示：

![](/assets/img/2024-09-18-46环的秘密-解算与拟合篇/coor.png)
_不同的坐标系_
